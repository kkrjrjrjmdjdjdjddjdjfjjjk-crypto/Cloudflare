// <!--GAMFC-->version base on commit: 2b9647fd3aa6f7a1f4d005687e0e244dfb29fef9 - last update: 2025-12-16 20:25:18 UTC <!--GAMFC-END-->.

import{connect}from'cloudflare:sockets';const Config={'userID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':['nima.nscl.ir:443','bpb.yousef.isegaro.com:443'],'scamalytics':{'username':'victoriacrossn','apiKey':'ed89b4fef21aba43c15cdd15cff2138dd8d3bbde5aaaa4690ad8e94990448516','baseUrl':'https://api12.scamalytics.com/v3/'},'socks5':{'enabled':![],'relayMode':![],'address':''},async 'fromEnv'(a){let b=null;if(a['DB'])try{const {results:f}=await a['DB']['prepare']('SELECT\x20ip_port\x20FROM\x20proxy_health\x20WHERE\x20is_healthy\x20=\x201\x20ORDER\x20BY\x20latency_ms\x20ASC\x20LIMIT\x201')['all']();b=f[0x0]?.['ip_port']||null;}catch(g){console['error']('Failed\x20to\x20read\x20proxy\x20health\x20from\x20DB:\x20'+g['message']);}!b&&(b=a['PROXYIP']);!b&&(b=this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])]);!b&&(b=this['proxyIPs'][0x0]);const [c,d='443']=b['split'](':');return{'userID':a['UUID']||this['userID'],'proxyIP':c,'proxyPort':parseInt(d,0xa),'proxyAddress':b,'scamalytics':{'username':a['SCAMALYTICS_USERNAME']||this['scamalytics']['username'],'apiKey':a['SCAMALYTICS_API_KEY']||this['scamalytics']['apiKey'],'baseUrl':a['SCAMALYTICS_BASEURL']||this['scamalytics']['baseUrl']},'socks5':{'enabled':!!a['SOCKS5'],'relayMode':a['SOCKS5_RELAY']==='true'||this['socks5']['relayMode'],'address':a['SOCKS5']||this['socks5']['address']}};}},CONST={'ED_PARAMS':{'ed':0xa00,'eh':'Sec-WebSocket-Protocol'},'VLESS_PROTOCOL':'vless','WS_READY_STATE_OPEN':0x1,'WS_READY_STATE_CLOSING':0x2,'ADMIN_LOGIN_FAIL_LIMIT':0x5,'ADMIN_LOGIN_LOCK_TTL':0x258,'SCAMALYTICS_THRESHOLD':0x32,'USER_PATH_RATE_LIMIT':0x14,'USER_PATH_RATE_TTL':0x3c,'AUTO_REFRESH_INTERVAL':0xea60,'IP_CLEANUP_AGE_DAYS':0x1e,'HEALTH_CHECK_INTERVAL':0x493e0,'HEALTH_CHECK_TIMEOUT':0x1388};function generateNonce(){const a=new Uint8Array(0x10);return crypto['getRandomValues'](a),btoa(String['fromCharCode']['apply'](null,a));}function addSecurityHeaders(a,b,c={}){const d=b?'script-src\x20\x27self\x27\x20\x27nonce-'+b+'\x27\x20\x27unsafe-inline\x27\x20https://cdnjs.cloudflare.com\x20https://unpkg.com\x20https://cdn.jsdelivr.net':'script-src\x20\x27self\x27\x20https://cdnjs.cloudflare.com\x20https://unpkg.com\x20https://cdn.jsdelivr.net\x20\x27unsafe-inline\x27',e=['default-src\x20\x27self\x27','form-action\x20\x27self\x27','object-src\x20\x27none\x27','frame-ancestors\x20\x27none\x27','base-uri\x20\x27self\x27',d,'style-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20\x27unsafe-hashes\x27',('img-src\x20\x27self\x27\x20data:\x20blob:\x20https:\x20'+(c['img']||''))['trim'](),('connect-src\x20\x27self\x27\x20https:\x20wss:\x20'+(c['connect']||''))['trim'](),'worker-src\x20\x27self\x27\x20blob:','child-src\x20\x27self\x27\x20blob:'];a['set']('Content-Security-Policy',e['join'](';\x20')),a['set']('Strict-Transport-Security','max-age=63072000;\x20includeSubDomains;\x20preload'),a['set']('X-Content-Type-Options','nosniff'),a['set']('X-Frame-Options','SAMEORIGIN'),a['set']('Referrer-Policy','strict-origin-when-cross-origin'),a['set']('Permissions-Policy','camera=(),\x20microphone=(),\x20geolocation=(),\x20payment=(),\x20usb=()'),a['set']('alt-svc','h3=\x22:443\x22;\x20ma=86400'),a['set']('Cross-Origin-Opener-Policy','same-origin'),a['set']('Cross-Origin-Embedder-Policy','unsafe-none'),a['set']('Cross-Origin-Resource-Policy','cross-origin');}function timingSafeEqual(c,d){if(typeof c!=='string'||typeof d!=='string')return![];const e=c['length'],f=d['length'];let g=0x0;if(e!==f){for(let h=0x0;h<e;h++){g|=c['charCodeAt'](h)^c['charCodeAt'](h);}return![];}for(let j=0x0;j<e;j++){g|=c['charCodeAt'](j)^d['charCodeAt'](j);}return g===0x0;}function escapeHTML(a){if(typeof a!=='string')return'';return a['replace'](/[&<>"'/`]/g,b=>({'&':'&amp;','<':'&lt;','>':'&gt;','\x22':'&quot;','\x27':'&#39;','/':'&#x2F;','`':'&#x60;'}[b]));}function safeBase64Encode(a){try{const b=new TextEncoder(),c=b['encode'](a);let d='';for(let f=0x0;f<c['length'];f++){d+=String['fromCharCode'](c[f]);}return btoa(d);}catch(g){return btoa(unescape(encodeURIComponent(a)));}}function generateUUID(){return crypto['randomUUID']();}function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isExpired(a,b){if(!a||!b)return!![];const c=b['includes'](':')&&b['split'](':')['length']===0x2?b+':00':b,d=c['split']('.')[0x0],e=new Date(a+'T'+d+'Z');return e<=new Date()||isNaN(e['getTime']());}async function formatBytes(a){if(a===0x0)return'0\x20Bytes';const b=0x400,c=['Bytes','KB','MB','GB','TB'],d=Math['floor'](Math['log'](a)/Math['log'](b));return parseFloat((a/Math['pow'](b,d))['toFixed'](0x2))+'\x20'+c[d];}async function kvGet(a,b,c='text'){if(!a)return null;try{const d=a['prepare']('SELECT\x20value,\x20expiration\x20FROM\x20key_value\x20WHERE\x20key\x20=\x20?')['bind'](b),f=await d['first']();if(!f)return null;if(f['expiration']&&f['expiration']<Math['floor'](Date['now']()/0x3e8))return await a['prepare']('DELETE\x20FROM\x20key_value\x20WHERE\x20key\x20=\x20?')['bind'](b)['run'](),null;if(c==='json')return JSON['parse'](f['value']);return f['value'];}catch(g){return console['error']('kvGet\x20error\x20for\x20'+b+':\x20'+g),null;}}async function kvPut(a,b,c,d={}){if(!a)return;try{typeof c==='object'&&(c=JSON['stringify'](c));const f=d['expirationTtl']?Math['floor'](Date['now']()/0x3e8+d['expirationTtl']):null;await a['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20key_value\x20(key,\x20value,\x20expiration)\x20VALUES\x20(?,\x20?,\x20?)')['bind'](b,c,f)['run']();}catch(g){console['error']('kvPut\x20error\x20for\x20'+b+':\x20'+g);}}async function kvDelete(a,b){if(!a)return;try{await a['prepare']('DELETE\x20FROM\x20key_value\x20WHERE\x20key\x20=\x20?')['bind'](b)['run']();}catch(c){console['error']('kvDelete\x20error\x20for\x20'+b+':\x20'+c);}}async function getUserData(a,b,c){try{if(!isValidUUID(b))return null;if(!a['DB'])return null;const d='user:'+b;let f=await kvGet(a['DB'],d,'json');if(f&&f['uuid'])return f;const g=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();if(!g)return null;const h=kvPut(a['DB'],d,g,{'expirationTtl':0xe10});return c?c['waitUntil'](h):await h,g;}catch(i){return console['error']('getUserData\x20error\x20for\x20'+b+':\x20'+i['message']),null;}}async function updateUsage(a,b,c,d){if(c<=0x0||!b||!a['DB'])return;const e='usage_lock:'+b;let f=![],g=0x0;try{while(!f&&g<0x5){const k=await kvGet(a['DB'],e);!k?(await kvPut(a['DB'],e,'locked',{'expirationTtl':0x5}),f=!![]):await new Promise(l=>setTimeout(l,0x64)),g++;}if(!f)return;const h=Math['round'](c),i=a['DB']['prepare']('UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](h,b)['run'](),j=kvDelete(a['DB'],'user:'+b);d?d['waitUntil'](Promise['all']([i,j])):await Promise['all']([i,j]);}catch(l){console['error']('Failed\x20to\x20update\x20usage\x20for\x20'+b+':',l);}finally{f&&await kvDelete(a['DB'],e)['catch'](m=>console['error']('Lock\x20release\x20error\x20for\x20'+b+':',m));}}async function cleanupOldIps(a,b){if(!a['DB'])return;try{const c=a['DB']['prepare']('DELETE\x20FROM\x20user_ips\x20WHERE\x20last_seen\x20<\x20datetime(\x27now\x27,\x20?)')['bind']('-'+CONST['IP_CLEANUP_AGE_DAYS']+'\x20days')['run']();b?b['waitUntil'](c):await c;}catch(d){console['error']('cleanupOldIps\x20error:\x20'+d['message']);}}async function isSuspiciousIP(a,b,c=CONST['SCAMALYTICS_THRESHOLD']){if(!b['username']||!b['apiKey'])return![];const d=new AbortController(),f=setTimeout(()=>d['abort'](),0x1388);try{const g=b['baseUrl']+'score?username='+b['username']+'&ip='+a+'&key='+b['apiKey'],h=await fetch(g,{'signal':d['signal']});if(!h['ok'])return![];const i=await h['json']();return i['score']>=c;}catch(j){return![];}finally{clearTimeout(f);}}function base32ToBuffer(a){const b='ABCDEFGHIJKLMNOPQRSTUVWXYZ234567',c=a['toUpperCase']()['replace'](/=+$/,'');let d=0x0,e=0x0,f=0x0;const g=new Uint8Array(Math['floor'](c['length']*0x5/0x8));for(let h=0x0;h<c['length'];h++){const j=b['indexOf'](c[h]);if(j===-0x1)throw new Error('Invalid\x20Base32\x20character');e=e<<0x5|j,d+=0x5,d>=0x8&&(g[f++]=e>>>d-0x8&0xff,d-=0x8);}return g['buffer'];}async function generateHOTP(a,b){const c=new ArrayBuffer(0x8),d=new DataView(c);d['setBigUint64'](0x0,BigInt(b),![]);const e=await crypto['subtle']['importKey']('raw',a,{'name':'HMAC','hash':'SHA-1'},![],['sign']),f=await crypto['subtle']['sign']('HMAC',e,c),g=new Uint8Array(f),h=g[g['length']-0x1]&0xf,i=(g[h]&0x7f)<<0x18|(g[h+0x1]&0xff)<<0x10|(g[h+0x2]&0xff)<<0x8|g[h+0x3]&0xff,j=i%0xf4240;return j['toString']()['padStart'](0x6,'0');}async function validateTOTP(a,b){if(!a||!b||b['length']!==0x6||!/^\d{6}$/['test'](b))return![];let c;try{c=base32ToBuffer(a);}catch(i){return![];}const d=0x1e,f=Math['floor'](Date['now']()/0x3e8),g=Math['floor'](f/d),h=[g,g-0x1,g+0x1];for(const j of h){const k=await generateHOTP(c,j);if(timingSafeEqual(b,k))return!![];}return![];}async function hashSHA256(a){const b=new TextEncoder(),c=b['encode'](a),d=await crypto['subtle']['digest']('SHA-256',c),e=Array['from'](new Uint8Array(d));return e['map'](f=>f['toString'](0x10)['padStart'](0x2,'0'))['join']('');}async function checkRateLimit(a,b,c,d){if(!a)return![];try{const f=await kvGet(a,b),g=parseInt(f,0xa)||0x0;if(g>=c)return!![];return await kvPut(a,b,(g+0x1)['toString'](),{'expirationTtl':d}),![];}catch(h){return![];}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a,b=0x0){return(byteToHex[a[b]]+byteToHex[a[b+0x1]]+byteToHex[a[b+0x2]]+byteToHex[a[b+0x3]]+'-'+byteToHex[a[b+0x4]]+byteToHex[a[b+0x5]]+'-'+byteToHex[a[b+0x6]]+byteToHex[a[b+0x7]]+'-'+byteToHex[a[b+0x8]]+byteToHex[a[b+0x9]]+'-'+byteToHex[a[b+0xa]]+byteToHex[a[b+0xb]]+byteToHex[a[b+0xc]]+byteToHex[a[b+0xd]]+byteToHex[a[b+0xe]]+byteToHex[a[b+0xf]])['toLowerCase']();}function stringify(a,b=0x0){const c=unsafeStringify(a,b);if(!isValidUUID(c))throw new TypeError('Stringified\x20UUID\x20is\x20invalid');return c;}function generateRandomPath(a=0xc){const b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let c='';for(let d=0x0;d<a;d++){c+=b['charAt'](Math['floor'](Math['random']()*b['length']));}return'/'+c;}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{'ed':'2560'}},'tcp':{'path':()=>generateRandomPath(0xc),'security':'none','fp':'chrome','extra':{'ed':'2560'}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':CONST['ED_PARAMS']},'tcp':{'path':()=>generateRandomPath(0x12),'security':'none','fp':'firefox','extra':CONST['ED_PARAMS']}}};function makeName(a,b){return a+'-'+b['toUpperCase']();}function randomizeCase(a){let b='';for(let c=0x0;c<a['length'];c++){b+=Math['random']()<0.5?a[c]['toUpperCase']():a[c]['toLowerCase']();}return b;}function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'encryption':'none','type':'ws','host':d,'path':e});f&&(l['set']('security',f),f==='tls'&&l['set']('allowInsecure','1'));if(g)l['set']('sni',g);if(h)l['set']('fp',h);if(i)l['set']('alpn',i);for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,proto:b,userID:c,hostName:d,address:e,port:f,tag:g}){const h=CORE_PRESETS[a][b];return createVlessLink({'userID':c,'address':e,'port':f,'host':d,'path':h['path'](),'security':h['security'],'sni':h['security']==='tls'?randomizeCase(d):undefined,'fp':h['fp'],'alpn':h['alpn'],'extra':h['extra'],'name':makeName(g,b)});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function handleIpSubscription(a,b,c){const d=[c,'creativecommons.org','www.speedtest.net','sky.rethinkdns.com','cfip.1323123.xyz','go.inmobi.com','www.visa.com','www.wto.org','cf.090227.xyz','cdnjs.com','zula.ir','mail.tm','temp-mail.org','ipaddress.my','mdbmax.com','check-host.net','kodambroker.com','iplocation.io','whatismyip.org','www.linkedin.com','exir.io','arzex.io','ok-ex.io','arzdigital.com','pouyanit.com','auth.grok.com','grok.com','maxmind.com','whatsmyip.com','iplocation.net','ipchicken.com','showmyip.com','router-network.com','whatismyipaddress.com'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830],g=[0x50,0x1f90,0x22b0,0x804,0x822,0x826,0x82f];let h=[];const i=c['endsWith']('.pages.dev');d['forEach']((m,n)=>{h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':m,'port':pick(f),'tag':'D'+(n+0x1)})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':m,'port':pick(g),'tag':'D'+(n+0x1)}));});const j='cf_ips';let k=await kvGet(env['DB'],j,'json');if(!k)try{const m=await fetch('https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json');if(m['ok']){const n=await m['json']();k=[...n['ipv4']||[],...n['ipv6']||[]]['slice'](0x0,0x14)['map'](o=>o['ip']),await kvPut(env['DB'],j,k,{'expirationTtl':0x15180});}}catch(o){console['error']('Fetch\x20IP\x20list\x20failed',o);}k&&k['forEach']((p,q)=>{const s=p['includes'](':')?'['+p+']':p;h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':s,'port':pick(f),'tag':'IP'+(q+0x1)})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':s,'port':pick(g),'tag':'IP'+(q+0x1)}));});const l=new Headers({'Content-Type':'text/plain;charset=utf-8','Profile-Update-Interval':'6'});return addSecurityHeaders(l,null,{}),new Response(safeBase64Encode(h['join']('\x0a')),{'headers':l});}async function ensureTablesExist(a,b){if(!a['DB'])return;try{const c=['CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20expiration_date\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20expiration_time\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20notes\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_used\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip_limit\x20INTEGER\x20DEFAULT\x20-1\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_ips\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20last_seen\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(uuid,\x20ip),\x0a\x20\x20\x20\x20\x20\x20\x20\x20FOREIGN\x20KEY\x20(uuid)\x20REFERENCES\x20users(uuid)\x20ON\x20DELETE\x20CASCADE\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20key_value\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20expiration\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20proxy_health\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip_port\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20is_healthy\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20latency_ms\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20last_check\x20INTEGER\x20DEFAULT\x20(strftime(\x27%s\x27,\x20\x27now\x27))\x0a\x20\x20\x20\x20\x20\x20)'];await a['DB']['batch'](c['map'](i=>a['DB']['prepare'](i)));const d=a['UUID']||Config['userID'],f=new Date();f['setMonth'](f['getMonth']()+0x1);const g=f['toISOString']()['split']('T')[0x0],h='23:59:59';await a['DB']['prepare']('INSERT\x20OR\x20IGNORE\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20traffic_used,\x20ip_limit)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)')['bind'](d,g,h,'Test\x20User\x20-\x20Development',null,0x40000000,-0x1)['run']();}catch(i){console['error']('D1\x20tables\x20init\x20failed:',i);}}async function performHealthCheck(a,b){if(!a['DB'])return;const c=a['PROXYIPS']?a['PROXYIPS']['split'](',')['map'](f=>f['trim']()):Config['proxyIPs'],d=c['map'](async f=>{const [g,h='443']=f['split'](':');let i=null,j=0x0;const k=Date['now']();try{const l=new AbortController(),m=setTimeout(()=>l['abort'](),CONST['HEALTH_CHECK_TIMEOUT']),n=await fetch('https://'+g+':'+h,{'signal':l['signal'],'method':'HEAD'});clearTimeout(m),(n['ok']||n['status']===0x194)&&(i=Date['now']()-k,j=0x1);}catch(o){console['error']('Health\x20check\x20failed\x20for\x20'+f+':\x20'+o['message']);}return a['DB']['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20proxy_health\x20(ip_port,\x20is_healthy,\x20latency_ms,\x20last_check)\x20VALUES\x20(?,\x20?,\x20?,\x20?)')['bind'](f,j,i,Math['floor'](Date['now']()/0x3e8));});try{await a['DB']['batch'](await Promise['all'](d));}catch(f){console['error']('Health\x20check\x20batch\x20error:\x20'+f['message']);}}const adminLoginHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Admin\x20Login\x20-\x20VLESS\x20Proxy</title>\x0a\x20\x20<style\x20nonce=\x22CSP_NONCE_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20body\x20{\x20background:\x20linear-gradient(135deg,\x20#1a1a2e\x200%,\x20#16213e\x20100%);\x20font-family:\x20-apple-system,\x20sans-serif;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20min-height:\x20100vh;\x20}\x0a\x20\x20\x20\x20.login-container\x20{\x20background:\x20rgba(255,\x20255,\x20255,\x200.05);\x20backdrop-filter:\x20blur(10px);\x20padding:\x2040px;\x20border-radius:\x2016px;\x20box-shadow:\x200\x208px\x2032px\x20rgba(0,\x200,\x200,\x200.3);\x20max-width:\x20400px;\x20border:\x201px\x20solid\x20rgba(255,\x20255,\x20255,\x200.1);\x20}\x0a\x20\x20\x20\x20h1\x20{\x20color:\x20#ffffff;\x20margin-bottom:\x2024px;\x20font-size:\x2028px;\x20}\x0a\x20\x20\x20\x20form\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2016px;\x20}\x0a\x20\x20\x20\x20input\x20{\x20background:\x20rgba(255,\x20255,\x20255,\x200.1);\x20border:\x201px\x20solid\x20rgba(255,\x20255,\x20255,\x200.2);\x20color:\x20#ffffff;\x20padding:\x2014px;\x20border-radius:\x208px;\x20transition:\x20all\x200.3s;\x20}\x0a\x20\x20\x20\x20input:focus\x20{\x20border-color:\x20#3b82f6;\x20box-shadow:\x200\x200\x200\x203px\x20rgba(59,\x20130,\x20246,\x200.2);\x20background:\x20rgba(255,\x20255,\x20255,\x200.15);\x20}\x0a\x20\x20\x20\x20button\x20{\x20background:\x20linear-gradient(135deg,\x20#3b82f6\x200%,\x20#2563eb\x20100%);\x20color:\x20white;\x20border:\x20none;\x20padding:\x2014px;\x20border-radius:\x208px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20all\x200.3s;\x20}\x0a\x20\x20\x20\x20button:hover\x20{\x20transform:\x20translateY(-2px);\x20box-shadow:\x200\x204px\x2020px\x20rgba(59,\x20130,\x20246,\x200.4);\x20}\x0a\x20\x20\x20\x20.error\x20{\x20color:\x20#ff6b6b;\x20margin-top:\x2016px;\x20background:\x20rgba(255,\x20107,\x20107,\x200.1);\x20padding:\x2012px;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20rgba(255,\x20107,\x20107,\x200.3);\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22login-container\x22>\x0a\x20\x20\x20\x20<h1>üîê\x20Admin\x20Login</h1>\x0a\x20\x20\x20\x20<form\x20method=\x22POST\x22\x20action=\x22ADMIN_PATH_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22Enter\x20admin\x20password\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20name=\x22totp\x22\x20placeholder=\x222FA\x20Code\x20(if\x20enabled)\x22\x20maxlength=\x226\x22>\x0a\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22>Login</button>\x0a\x20\x20\x20\x20</form>\x0a\x20\x20</div>\x0a</body>\x0a</html>',adminPanelHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Admin\x20Dashboard\x20-\x20VLESS\x20Proxy\x20Manager</title>\x0a\x20\x20<style\x20nonce=\x22CSP_NONCE_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20:root\x20{\x20--bg-main:\x20#0a0e17;\x20--text-primary:\x20#F9FAFB;\x20--accent:\x20#3B82F6;\x20--danger:\x20#EF4444;\x20--success:\x20#22C55E;\x20--purple:\x20#a855f7;\x20}\x0a\x20\x20\x20\x20body\x20{\x20background:\x20linear-gradient(135deg,\x20#0a0e17\x200%,\x20#111827\x20100%);\x20color:\x20var(--text-primary);\x20font-family:\x20Inter,\x20sans-serif;\x20min-height:\x20100vh;\x20}\x0a\x20\x20\x20\x20.container\x20{\x20max-width:\x201400px;\x20margin:\x200\x20auto;\x20padding:\x2040px\x2020px;\x20}\x0a\x20\x20\x20\x20.card\x20{\x20background:\x20linear-gradient(145deg,\x20rgba(26,\x2031,\x2046,\x200.9)\x200%,\x20rgba(17,\x2024,\x2039,\x200.95)\x20100%);\x20border-radius:\x2016px;\x20padding:\x2028px;\x20border:\x201px\x20solid\x20rgba(255,\x20255,\x20255,\x200.06);\x20margin-bottom:\x2024px;\x20}\x0a\x20\x20\x20\x20.dashboard-stats\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(180px,\x201fr));\x20gap:\x2016px;\x20}\x0a\x20\x20\x20\x20.stat-card\x20{\x20background:\x20linear-gradient(145deg,\x20rgba(26,\x2031,\x2046,\x200.9)\x200%,\x20rgba(17,\x2024,\x2039,\x200.95)\x20100%);\x20padding:\x2024px;\x20border-radius:\x2016px;\x20text-align:\x20center;\x20}\x0a\x20\x20\x20\x20.form-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(220px,\x201fr));\x20gap:\x2016px;\x20}\x0a\x20\x20\x20\x20input,\x20select\x20{\x20background:\x20#374151;\x20border:\x201px\x20solid\x20#4B5563;\x20color:\x20var(--text-primary);\x20padding:\x2012px;\x20border-radius:\x208px;\x20}\x0a\x20\x20\x20\x20.btn\x20{\x20padding:\x2012px\x2022px;\x20border-radius:\x2010px;\x20cursor:\x20pointer;\x20}\x0a\x20\x20\x20\x20.btn-primary\x20{\x20background:\x20linear-gradient(135deg,\x20var(--accent)\x200%,\x20#6366f1\x20100%);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20table\x20{\x20width:\x20100%;\x20border-collapse:\x20collapse;\x20}\x0a\x20\x20\x20\x20th,\x20td\x20{\x20padding:\x2014px\x2016px;\x20border-bottom:\x201px\x20solid\x20rgba(255,\x20255,\x20255,\x200.04);\x20}\x0a\x20\x20\x20\x20.chart-container\x20{\x20height:\x20300px;\x20}\x0a\x20\x20\x20\x20.search-input\x20{\x20width:\x20100%;\x20margin-bottom:\x2020px;\x20}\x0a\x20\x20\x20\x20.bulk-actions\x20{\x20display:\x20flex;\x20gap:\x2010px;\x20margin-bottom:\x2020px;\x20}\x0a\x20\x20</style>\x0a\x20\x20<script\x20src=\x22https://cdn.jsdelivr.net/npm/chart.js\x22></script>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<h1>Admin\x20Dashboard</h1>\x0a\x20\x20\x20\x20<div\x20class=\x22dashboard-stats\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><div\x20id=\x22total-users\x22>0</div><div>Total\x20Users</div></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><div\x20id=\x22active-users\x22>0</div><div>Active\x20Users</div></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><div\x20id=\x22traffic-used\x22>0\x20GB</div><div>Traffic\x20Used</div></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><div\x20id=\x22health-status\x22>Healthy</div><div>System\x20Health</div></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>User\x20Traffic\x20Chart</h2>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22chart-container\x22><canvas\x20id=\x22traffic-chart\x22></canvas></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>User\x20Management</h2>\x0a\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22search-input\x22\x20placeholder=\x22Search\x20users...\x22\x20onkeyup=\x22filterTable()\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bulk-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22addUser()\x22>Add\x20User</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22bulkDelete()\x22>Bulk\x20Delete</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22exportUsers()\x22>Export\x20CSV</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22table-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20id=\x22user-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th><input\x20type=\x22checkbox\x22\x20onclick=\x22toggleAll(this)\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>UUID</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Expiration</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Traffic\x20Used</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Status</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Actions</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20Dynamic\x20users\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x20\x20<div\x20id=\x22toast\x22></div>\x0a\x20\x20<div\x20class=\x22modal-overlay\x22\x20id=\x22add-user-modal\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>Add\x20New\x20User</h2>\x0a\x20\x20\x20\x20\x20\x20<form\x20id=\x22add-user-form\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Date</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20name=\x22exp_date\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Time</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20name=\x22exp_time\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Notes</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20name=\x22notes\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20User</button>\x0a\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x20\x20<script\x20nonce=\x22CSP_NONCE_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20let\x20users\x20=\x20[];\x0a\x20\x20\x20\x20const\x20trafficChart\x20=\x20new\x20Chart(document.getElementById(\x27traffic-chart\x27),\x20{\x0a\x20\x20\x20\x20\x20\x20type:\x20\x27line\x27,\x0a\x20\x20\x20\x20\x20\x20data:\x20{\x20labels:\x20[],\x20datasets:\x20[{\x20label:\x20\x27Traffic\x20(GB)\x27,\x20data:\x20[],\x20borderColor:\x20var(--accent)\x20}]\x20},\x0a\x20\x20\x20\x20\x20\x20options:\x20{\x20responsive:\x20true,\x20scales:\x20{\x20y:\x20{\x20beginAtZero:\x20true\x20}\x20}\x20}\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20async\x20function\x20loadUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20users\x20=\x20await\x20fetch(\x27/api/users\x27).then(res\x20=>\x20res.json());\x0a\x20\x20\x20\x20\x20\x20const\x20tableBody\x20=\x20document.querySelector(\x27#user-table\x20tbody\x27);\x0a\x20\x20\x20\x20\x20\x20tableBody.innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20users.forEach(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20row\x20=\x20document.createElement(\x27tr\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20row.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><input\x20type=\x22checkbox\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.uuid}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.expiration_date}\x20${user.expiration_time}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.traffic_used}\x20bytes</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><span\x20class=\x22${user.is_expired\x20?\x20\x27status-expired\x27\x20:\x20\x27status-active\x27}\x22>${user.is_expired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27}</span></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22editUser(\x27${user.uuid}\x27)\x22>Edit</button>\x20<button\x20onclick=\x22deleteUser(\x27${user.uuid}\x27)\x22>Delete</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20tableBody.appendChild(row);\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20updateStats();\x0a\x20\x20\x20\x20\x20\x20updateChart();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20updateStats()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27total-users\x27).textContent\x20=\x20users.length;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27active-users\x27).textContent\x20=\x20users.filter(u\x20=>\x20!u.is_expired).length;\x0a\x20\x20\x20\x20\x20\x20const\x20totalTraffic\x20=\x20users.reduce((sum,\x20u)\x20=>\x20sum\x20+\x20u.traffic_used,\x200)\x20/\x20(1024\x20*\x201024\x20*\x201024);\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27traffic-used\x27).textContent\x20=\x20totalTraffic.toFixed(2)\x20+\x20\x27\x20GB\x27;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27health-status\x27).textContent\x20=\x20\x27Healthy\x27;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20updateChart()\x20{\x0a\x20\x20\x20\x20\x20\x20trafficChart.data.labels\x20=\x20users.map(u\x20=>\x20u.uuid.slice(0,\x208));\x0a\x20\x20\x20\x20\x20\x20trafficChart.data.datasets[0].data\x20=\x20users.map(u\x20=>\x20u.traffic_used\x20/\x20(1024\x20*\x201024\x20*\x201024));\x0a\x20\x20\x20\x20\x20\x20trafficChart.update();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20filterTable()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20input\x20=\x20document.querySelector(\x27.search-input\x27).value.toLowerCase();\x0a\x20\x20\x20\x20\x20\x20const\x20rows\x20=\x20document.querySelectorAll(\x27#user-table\x20tbody\x20tr\x27);\x0a\x20\x20\x20\x20\x20\x20rows.forEach(row\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20row.style.display\x20=\x20row.textContent.toLowerCase().includes(input)\x20?\x20\x27\x27\x20:\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20toggleAll(source)\x20{\x0a\x20\x20\x20\x20\x20\x20document.querySelectorAll(\x27#user-table\x20input[type=\x22checkbox\x22]\x27).forEach(cb\x20=>\x20cb.checked\x20=\x20source.checked);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20addUser()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27add-user-modal\x27).classList.add(\x27show\x27);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20document.getElementById(\x27add-user-form\x27).addEventListener(\x27submit\x27,\x20async\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20const\x20formData\x20=\x20new\x20FormData(e.target);\x0a\x20\x20\x20\x20\x20\x20await\x20fetch(\x27/api/add-user\x27,\x20{\x20method:\x20\x27POST\x27,\x20body:\x20formData\x20});\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27add-user-modal\x27).classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20function\x20editUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20alert(\x27Edit\x20user\x20\x27\x20+\x20uuid);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20deleteUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(confirm(\x27Delete\x20user?\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20fetch(\x27/api/delete-user/\x27\x20+\x20uuid,\x20{\x20method:\x20\x27DELETE\x27\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20bulkDelete()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20selected\x20=\x20Array.from(document.querySelectorAll(\x27#user-table\x20input[type=\x22checkbox\x22]:checked\x27)).map(cb\x20=>\x20cb.parentElement.nextElementSibling.textContent);\x0a\x20\x20\x20\x20\x20\x20if\x20(selected.length\x20&&\x20confirm(\x27Delete\x20selected?\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20fetch(\x27/api/bulk-delete\x27,\x20{\x20method:\x20\x27POST\x27,\x20body:\x20JSON.stringify(selected)\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20exportUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20csv\x20=\x20\x27UUID,Expiration,Traffic\x5cn\x27\x20+\x20users.map(u\x20=>\x20`${u.uuid},${u.expiration_date}\x20${u.expiration_time},${u.traffic_used}`).join(\x27\x5cn\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20blob\x20=\x20new\x20Blob([csv],\x20{\x20type:\x20\x27text/csv\x27\x20});\x0a\x20\x20\x20\x20\x20\x20const\x20url\x20=\x20URL.createObjectURL(blob);\x0a\x20\x20\x20\x20\x20\x20const\x20a\x20=\x20document.createElement(\x27a\x27);\x0a\x20\x20\x20\x20\x20\x20a.href\x20=\x20url;\x0a\x20\x20\x20\x20\x20\x20a.download\x20=\x20\x27users.csv\x27;\x0a\x20\x20\x20\x20\x20\x20a.click();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20setInterval(loadUsers,\x20CONST.AUTO_REFRESH_INTERVAL);\x0a\x20\x20</script>\x0a</body>\x0a</html>',userPanelHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>User\x20Panel\x20-\x20VLESS\x20Proxy</title>\x0a\x20\x20<style\x20nonce=\x22CSP_NONCE_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20body\x20{\x20background:\x20#0f172a;\x20color:\x20#f9fafb;\x20font-family:\x20Inter,\x20sans-serif;\x20min-height:\x20100vh;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20}\x0a\x20\x20\x20\x20.panel\x20{\x20max-width:\x20800px;\x20background:\x20rgba(255,255,255,0.05);\x20backdrop-filter:\x20blur(20px);\x20border-radius:\x2024px;\x20padding:\x2040px;\x20box-shadow:\x200\x2025px\x2070px\x20rgba(0,0,0,0.4);\x20}\x0a\x20\x20\x20\x20h1\x20{\x20font-size:\x2028px;\x20color:\x20#3b82f6;\x20margin-bottom:\x2020px;\x20}\x0a\x20\x20\x20\x20.stats\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(150px,\x201fr));\x20gap:\x2016px;\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20.stat\x20{\x20background:\x20rgba(255,255,255,0.02);\x20padding:\x2016px;\x20border-radius:\x2012px;\x20text-align:\x20center;\x20}\x0a\x20\x20\x20\x20.qr-section\x20{\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20#qr-code\x20{\x20background:\x20white;\x20padding:\x2020px;\x20border-radius:\x2016px;\x20display:\x20inline-block;\x20}\x0a\x20\x20\x20\x20.chart-container\x20{\x20height:\x20250px;\x20margin-top:\x2020px;\x20}\x0a\x20\x20\x20\x20.btn\x20{\x20background:\x20#3b82f6;\x20color:\x20white;\x20padding:\x2012px\x2020px;\x20border-radius:\x208px;\x20cursor:\x20pointer;\x20margin-top:\x2010px;\x20}\x0a\x20\x20</style>\x0a\x20\x20<script\x20src=\x22https://cdn.jsdelivr.net/npm/chart.js\x22></script>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22panel\x22>\x0a\x20\x20\x20\x20<h1>User\x20Panel</h1>\x0a\x20\x20\x20\x20<div\x20class=\x22stats\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22><h3>Traffic\x20Used</h3><p\x20id=\x22traffic-used\x22>0\x20GB</p></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22><h3>Expiration</h3><p\x20id=\x22expiration\x22>‚Äî</p></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22><h3>Status</h3><p\x20id=\x22status\x22>Active</p></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22qr-section\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>QR\x20Code</h2>\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22qr-code\x22></div>\x0a\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22testConfig()\x22>Test\x20Config</button>\x0a\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22downloadQR()\x22>Download\x20QR</button>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22chart-container\x22><canvas\x20id=\x22history-chart\x22></canvas></div>\x0a\x20\x20</div>\x0a\x20\x20<script\x20nonce=\x22CSP_NONCE_PLACEHOLDER\x22>\x0a\x20\x20\x20\x20var\x20QRCode=function(e,t){this._htOption={width:256,height:256,typeNumber:4,colorDark:\x22#000000\x22,colorLight:\x22#ffffff\x22,correctLevel:QRCode.CorrectLevel.H};if(typeof\x20t==\x22string\x22){t={text:t}}if(t){for(var\x20n\x20in\x20t){this._htOption[n]=t[n]}}if(typeof\x20this._htOption.typeNumber==\x22string\x22){this._htOption.typeNumber=parseInt(this._htOption.typeNumber)}if(typeof\x20this._htOption.correctLevel==\x22string\x22){this._htOption.correctLevel=QRCode.CorrectLevel[this._htOption.correctLevel]}this._oQRCode=new\x20QRCodeModel(this._htOption.typeNumber,this._htOption.correctLevel);this._oQRCode.addData(this._htOption.text);this._oQRCode.make();this.makeImage()};QRCode.CorrectLevel={L:1,M:0,Q:3,H:2};QRCode.prototype={makeImage:function(){var\x20e=this._htOption.width;var\x20t=this._htOption.height;var\x20n=this._oQRCode.moduleCount;var\x20i=Math.floor(t/n);var\x20r=Math.floor(e/n);var\x20o=\x22\x22;o+=\x27<table\x20style=\x22border:0;border-collapse:collapse;\x22>\x27;for(var\x20a=0;a<n;a++){o+=\x22<tr>\x22;for(var\x20s=0;s<n;s++){var\x20l=this._oQRCode.isDark(a,s)?this._htOption.colorDark:this._htOption.colorLight;o+=\x27<td\x20style=\x22border:0;border-collapse:collapse;padding:0;margin:0;width:\x27+r+\x22px;height:\x22+i+\x22px;background-color:\x22+l+\x27;\x22></td>\x27}o+=\x22</tr>\x22}o+=\x22</table>\x22;e.innerHTML=o}};function\x20QR8bitByte(e){this.mode=QRMode.MODE_8BIT_BYTE;this.data=e;this.parsedData=[];for(var\x20t=0,n=this.data.length;t<n;t++){var\x20i=[];var\x20r=this.data.charCodeAt(t);if(r>65536){i[0]=240|(r&1835008)>>>18;i[1]=128|(r&258048)>>>12;i[2]=128|(r&4032)>>>6;i[3]=128|\x20r&63}else\x20if(r>2048){i[0]=224|(r&61440)>>>12;i[1]=128|(r&4032)>>>6;i[2]=128|\x20r&63}else\x20if(r>128){i[0]=192|(r&1984)>>>6;i[1]=128|\x20r&63}else{i[0]=r}this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239)}}QR8bitByte.prototype={getLength:function(e){return\x20this.parsedData.length},write:function(e){for(var\x20t=0,n=this.parsedData.length;t<n;t++){e.put(this.parsedData[t],8)}}};function\x20QRCodeModel(e,t){this.typeNumber=e;this.errorCorrectLevel=t;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}var\x20qrcode=QRCodeModel.prototype;qrcode.addData=function(e){var\x20t=new\x20QR8bitByte(e);this.dataList.push(t);this.dataCache=null};qrcode.isDark=function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t){throw\x20new\x20Error(e+\x22,\x22+t)}return\x20this.modules[e][t]};qrcode.getModuleCount=function(){return\x20this.moduleCount};qrcode.make=function(){if(this.typeNumber<1){var\x20e=1;for(e=1;e<40;e++){var\x20t=QRRSBlock.getRSBlocks(e,this.errorCorrectLevel);var\x20n=new\x20QRBitBuffer();var\x20i=0;for(var\x20r=0;r<t.length;r++){i+=t[r].dataCount}for(var\x20r=0;r<this.dataList.length;r++){var\x20o=this.dataList[r];n.put(o.mode,4);n.put(o.getLength(),QRUtil.getLengthInBits(o.mode,e));o.write(n)}if(n.getLengthInBits()<=i*8)break}this.typeNumber=e}this.makeImpl(false,this.getBestMaskPattern())};qrcode.makeImpl=function(e,t){this.moduleCount=this.typeNumber*4+17;this.modules=new\x20Array(this.moduleCount);for(var\x20n=0;n<this.moduleCount;n++){this.modules[n]=new\x20Array(this.moduleCount);for(var\x20i=0;i<this.moduleCount;i++){this.modules[n][i]=null}}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(e,t);if(this.typeNumber>=7)this.setupTypeNumber(e);if(this.dataCache==null)this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);this.mapData(this.dataCache,t)};qrcode.setupPositionProbePattern=function(e,t){for(var\x20n=-1;n<=7;n++){if(e+n<=-1||this.moduleCount<=e+n)continue;if(t>=0&&t<=7){this.modules[e+n][t]=true;this.modules[e+n][t+6]=true;this.modules[e][t+n]=true;this.modules[e+6][t+n]=true}this.modules[e+n][t+1]=true;this.modules[e+n][t+5]=true;this.modules[e+1][t+n]=true;this.modules[e+5][t+n]=true;this.modules[e+1][t+1]=true;this.modules[e+1][t+2]=true;this.modules[e+1][t+3]=true;this.modules[e+1][t+4]=true;this.modules[e+1][t+5]=true;this.modules[e+2][t+1]=true;this.modules[e+3][t+1]=true;this.modules[e+4][t+1]=true;this.modules[e+5][t+1]=true;this.modules[e+5][t+2]=true;this.modules[e+5][t+3]=true;this.modules[e+5][t+4]=true;this.modules[e+5][t+5]=true;this.modules[e+2][t+5]=true;this.modules[e+3][t+5]=true;this.modules[e+4][t+5]=true}};qrcode.setupTimingPattern=function(){for(var\x20e=8;e<this.moduleCount-8;e++){if(this.modules[e][6]!=null)continue;this.modules[e][6]=e%2==0;this.modules[6][e]=e%2==0}};qrcode.setupPositionAdjustPattern=function(){var\x20e=QRUtil.getPatternPosition(this.typeNumber);for(var\x20t=0;t<e.length;t++){for(var\x20n=0;n<e.length;n++){var\x20i=e[t];var\x20r=e[n];if(this.modules[i][r]!=null)continue;for(var\x20o=-2;o<=2;o++){for(var\x20a=-2;a<=2;a++){if(o==-2||o==2||a==-2||a==2||o==0&&a==0){this.modules[i+o][r+a]=true}else{this.modules[i+o][r+a]=false}}\x20}}};qrcode.setupTypeNumber=function(e){var\x20t=QRUtil.getBCHTypeNumber(this.typeNumber);for(var\x20n=0;n<18;n++){var\x20i=!e&&\x20(t>>n&1)==1;this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=i}for(var\x20n=0;n<18;n++){var\x20i=!e&&\x20(t>>n&1)==1;this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=i}};qrcode.setupTypeInfo=function(e,t){var\x20n=this.errorCorrectLevel<<3|t;var\x20i=QRUtil.getBCHTypeInfo(n);for(var\x20r=0;r<15;r++){var\x20o=!e&&\x20(i>>r&1)==1;if(r<6)this.modules[r][8]=o;else\x20if(r<8)this.modules[r+1][8]=o;else\x20this.modules[this.moduleCount-15+r][8]=o}for(var\x20r=0;r<15;r++){var\x20o=!e&&\x20(i>>r&1)==1;if(r<8)this.modules[8][this.moduleCount-r-1]=o;else\x20if(r<9)this.modules[8][15-r-1+1]=o;else\x20this.modules[8][15-r-1]=o}this.modules[this.moduleCount-8][8]=!e};qrcode.mapData=function(e,t){var\x20n=-1;var\x20i=this.moduleCount-1;var\x20r=7;var\x20o=0;for(var\x20a=this.moduleCount-1;a>0;a-=2){if(a==6)a--;for(;;){for(var\x20s=0;s<2;s++){if(this.modules[i][a-s]==null){var\x20l=false;if(o<e.length){l=(e[o]>>>r&1)==1}if(QRUtil.getMask(t,i,a-s)){l=!l}this.modules[i][a-s]=l;r--;if(r==-1){o++;r=7}}}i+=n;if(i<0||this.moduleCount<=i){i-=n;n=-n;break}}}};QRCodeModel.PAD0=236;QRCodeModel.PAD1=17;QRCodeModel.createData=function(e,t,n){var\x20i=QRRSBlock.getRSBlocks(e,t);var\x20r=new\x20QRBitBuffer();for(var\x20o=0;o<n.length;o++){var\x20a=n[o];r.put(a.mode,4);r.put(a.getLength(),QRUtil.getLengthInBits(a.mode,e));a.write(r)}var\x20s=0;for(var\x20o=0;o<i.length;o++){s+=i[o].dataCount}if(r.getLengthInBits()>s*8){throw\x20new\x20Error(\x22code\x20length\x20overflow.\x20(\x22+r.getLengthInBits()+\x22>\x22+s*8+\x22)\x22)}if(r.getLengthInBits()+4<=s*8)r.put(0,4);while(r.getLengthInBits()%8!=0){r.putBit(false)}while(true){if(r.getLengthInBits()>=s*8){break}r.put(QRCodeModel.PAD0,8);if(r.getLengthInBits()>=s*8){break}r.put(QRCodeModel.PAD1,8)}return\x20QRCodeModel.createBytes(r,i)};QRCodeModel.createBytes=function(e,t){var\x20n=0;var\x20i=0;var\x20r=0;var\x20o=new\x20Array(t.length);var\x20a=new\x20Array(t.length);for(var\x20s=0;s<t.length;s++){var\x20l=t[s].dataCount;var\x20h=t[s].totalCount-l;i=Math.max(i,l);r=Math.max(r,h);o[s]=new\x20Array(l);for(var\x20u=0;u<o[s].length;u++){o[s][u]=255&e.buffer[u+n]}n+=l;var\x20c=QRUtil.getErrorCorrectPolynomial(h);var\x20f=new\x20QRPolynomial(o[s],c.getLength()-1);var\x20d=f.mod(c);a[s]=new\x20Array(c.getLength()-1);for(var\x20u=0;u<a[s].length;u++){var\x20p=u+d.getLength()-a[s].length;a[s][u]=p>=0?d.get(p):0}}var\x20v=0;for(var\x20u=0;u<t.length;u++){v+=t[u].totalCount}var\x20m=new\x20Array(v);var\x20g=0;for(var\x20u=0;u<i;u++){for(var\x20s=0;s<t.length;s++){if(u<o[s].length){m[g++]=o[s][u]}}}for(var\x20u=0;u<r;u++){for(var\x20s=0;s<t.length;s++){if(u<a[s].length){m[g++]=a[s][u]}}}return\x20m};function\x20QRBitBuffer(){this.buffer=[];this.length=0}QRBitBuffer.prototype={get:function(e){var\x20t=Math.floor(e/8);return\x20(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(var\x20n=0;n<t;n++){this.putBit((e>>>t-n-1&1)==1)}},getLengthInBits:function(){return\x20this.length},putBit:function(e){var\x20t=Math.floor(this.length/8);if(this.buffer.length<=t){this.buffer.push(0)}if(e){this.buffer[t]|=128>>>this.length%8}this.length++}};var\x20QRMode={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8};var\x20QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var\x20QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:32768|16384|8192|4096|2048|1024|512|1,G18:262144|131072|65536|32768|16384|8192|4096|2048|1024|1,G15_MASK:53248,getBCHTypeInfo:function(e){var\x20t=e<<3;while(QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G15)>=0){t^=QRUtil.G15<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G15)}return\x20(e<<3)|t},getBCHTypeNumber:function(e){var\x20t=e<<12;while(QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G18)>=0){t^=QRUtil.G18<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G18)}return\x20e<<12|t},getBCHDigit:function(e){var\x20t=0;while(e!=0){t++;e>>>=1}return\x20t},getPatternPosition:function(e){return\x20QRUtil.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case\x20QRMaskPattern.PATTERN000:return\x20(t+n)%2==0;case\x20QRMaskPattern.PATTERN001:return\x20t%2==0;case\x20QRMaskPattern.PATTERN010:return\x20n%3==0;case\x20QRMaskPattern.PATTERN011:return\x20(t+n)%3==0;case\x20QRMaskPattern.PATTERN100:return\x20(Math.floor(t/2)+Math.floor(n/3))%2==0;case\x20QRMaskPattern.PATTERN101:return\x20t*n%2+t*n%3==0;case\x20QRMaskPattern.PATTERN110:return\x20(t*n%2+t*n%3)%2==0;case\x20QRMaskPattern.PATTERN111:return\x20(t*n%3+(t+n)%2)%2==0;default:throw\x20new\x20Error(\x22bad\x20maskPattern:\x22+e)}},getErrorCorrectPolynomial:function(e){var\x20t=new\x20QRPolynomial([1],0);for(var\x20n=0;n<e;n++){t=t.multiply(new\x20QRPolynomial([1,QRMath.gexp(n)],0))}return\x20t},getLengthInBits:function(e,t){if(1<=t&&t<10){switch(e){case\x20QRMode.MODE_NUMBER:return\x2010;case\x20QRMode.MODE_ALPHA_NUM:return\x209;case\x20QRMode.MODE_8BIT_BYTE:return\x208;case\x20QRMode.MODE_KANJI:return\x208;default:throw\x20new\x20Error(\x22mode:\x22+e)}}else\x20if(t<27){switch(e){case\x20QRMode.MODE_NUMBER:return\x2012;case\x20QRMode.MODE_ALPHA_NUM:return\x2011;case\x20QRMode.MODE_8BIT_BYTE:return\x2016;case\x20QRMode.MODE_KANJI:return\x2010;default:throw\x20new\x20Error(\x22mode:\x22+e)}}else\x20if(t<41){switch(e){case\x20QRMode.MODE_NUMBER:return\x2014;case\x20QRMode.MODE_ALPHA_NUM:return\x2013;case\x20QRMode.MODE_8BIT_BYTE:return\x2016;case\x20QRMode.MODE_KANJI:return\x2012;default:throw\x20new\x20Error(\x22mode:\x22+e)}}else{throw\x20new\x20Error(\x22type:\x22+t)}},getLostPoint:function(e){var\x20t=e.getModuleCount();var\x20n=0;for(var\x20i=0;i<t;i++){for(var\x20r=0;r<t;r++){var\x20o=0;var\x20a=e.isDark(i,r);for(var\x20s=-1;s<=1;s++){if(i+s<0||t<=i+s)continue;for(var\x20l=-1;l<=1;l++){if(r+l<0||t<=r+l)continue;if(s==0&&l==0)continue;if(a==e.isDark(i+s,r+l))o++}}if(o>5)n+=3+o-5}}}for(var\x20i=0;i<t-1;i++){for(var\x20r=0;r<t-1;r++){var\x20h=0;if(e.isDark(i,r))h++;if(e.isDark(i+1,r))h++;if(e.isDark(i,r+1))h++;if(e.isDark(i+1,r+1))h++;if(h==0||h==4)n+=3}}}for(var\x20i=0;i<t;i++){for(var\x20r=0;r<t-6;r++){if(e.isDark(i,r)&&!e.isDark(i,r+1)&&e.isDark(i,r+2)&&e.isDark(i,r+3)&&e.isDark(i,r+4)&&!e.isDark(i,r+5)&&e.isDark(i,r+6))n+=40}}}for(var\x20r=0;r<t;r++){for(var\x20i=0;i<t-6;i++){if(e.isDark(i,r)&&!e.isDark(i+1,r)&&e.isDark(i+2,r)&&e.isDark(i+3,r)&&e.isDark(i+4,r)&&!e.isDark(i+5,r)&&e.isDark(i+6,r))n+=40}}}var\x20u=0;for(var\x20r=0;r<t;r++){for(var\x20i=0;i<t;i++){if(e.isDark(i,r))u++}}var\x20c=Math.abs(100*u/t/t-25)*4;if(c>20)n+=c;return\x20n}};var\x20QRMath={glog:function(e){if(e<1)throw\x20new\x20Error(\x22glog(\x22+e+\x22)\x22);return\x20QRMath.LOG_TABLE[e]},gexp:function(e){while(e<0){e+=255}while(e>=256){e-=255}return\x20QRMath.EXP_TABLE[e]},EXP_TABLE:new\x20Array(256),LOG_TABLE:new\x20Array(256)};for(var\x20i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i}for(var\x20i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8]}for(var\x20i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i}function\x20QRPolynomial(e,t){if(e.length==undefined)throw\x20new\x20Error(e.length+\x22/\x22+t);var\x20n=0;while(n<e.length&&e[n]==0){n++}this.num=new\x20Array(e.length-n+t);for(var\x20i=0;i<e.length-n;i++){this.num[i]=e[i+n]}}QRPolynomial.prototype={get:function(e){return\x20this.num[e]},getLength:function(){return\x20this.num.length},multiply:function(e){var\x20t=new\x20Array(this.getLength()+e.getLength()-1);for(var\x20n=0;n<this.getLength();n++){for(var\x20i=0;i<e.getLength();i++){t[n+i]^=QRMath.gexp(QRMath.glog(this.get(n))+QRMath.glog(e.get(i)))}}return\x20new\x20QRPolynomial(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return\x20this;var\x20t=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var\x20n=new\x20Array(this.getLength());for(var\x20i=0;i<this.getLength();i++){n[i]=this.get(i)}for(var\x20i=0;i<e.getLength();i++){n[i]^=QRMath.gexp(QRMath.glog(e.get(i))+t)}return\x20new\x20QRPolynomial(n,0).mod(e)}};var\x20QRRSBlock={RS_BLOCK_TABLE:[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[9,141,111,3,142,112],[3,67,41,13,68,42],[17,54,24,1,55,25],[11,36,12,13,37,13],[17,129,102,5,130,103],[19,60,38,3,61,39],[3,42,14,23,43,15],[4,27,9,23,28,10],[10,147,117,5,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],getRSBlocks:function(e,t){var\x20n=QRRSBlock.getRsBlockTable(e,t);if(n==undefined){throw\x20new\x20Error(\x22bad\x20rs\x20block\x20@\x20typeNumber:\x22+e+\x22/errorCorrectLevel:\x22+t)}var\x20i=n.length/3;var\x20r=new\x20Array();for(var\x20o=0;o<i;o++){var\x20a=n[o*3+0];var\x20s=n[o*3+1];var\x20l=n[o*3+2];for(var\x20h=0;h<a;h++){r.push(new\x20QRRSBlock(s,l))}}return\x20r},getRsBlockTable:function(e,t){switch(t){case\x20QRUtil.getErrorCorrectPolynomial(1).getLength()-1:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+0];case\x20QRUtil.getErrorCorrectPolynomial(0).getLength()-1:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+1];case\x20QRUtil.getErrorCorrectPolynomial(3).getLength()-1:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+2];case\x20QRUtil.getErrorCorrectPolynomial(2).getLength()-1:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+3]}}}};function\x20QRRSBlock(e,t){this.totalCount=e;this.dataCount=t}QRRSBlock.getRSBlocks=function(e,t){var\x20n=QRRSBlock.getRsBlockTable(e,t);if(n==undefined){throw\x20new\x20Error(\x22bad\x20rs\x20block\x20@\x20typeNumber:\x22+e+\x22/errorCorrectLevel:\x22+t)}var\x20i=n.length/3;var\x20r=[];for(var\x20o=0;o<i;o++){var\x20a=n[o*3+0];var\x20s=n[o*3+1];var\x20l=n[o*3+2];for(var\x20h=0;h<a;h++){r.push(new\x20QRRSBlock(s,l))}}return\x20r};QRRSBlock.getRsBlockTable=function(e,t){switch(t){case\x20QRErrorCorrectLevel.L:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+0];case\x20QRErrorCorrectLevel.M:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+1];case\x20QRErrorCorrectLevel.Q:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+2];case\x20QRErrorCorrectLevel.H:return\x20QRRSBlock.RS_BLOCK_TABLE[(e-1)*4+3];default:return\x20undefined}};var\x20QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};\x20\x0a\x0a\x20\x20\x20\x20let\x20userData\x20=\x20{};\x0a\x20\x20\x20\x20const\x20historyChart\x20=\x20new\x20Chart(document.getElementById(\x27history-chart\x27),\x20{\x0a\x20\x20\x20\x20\x20\x20type:\x20\x27bar\x27,\x0a\x20\x20\x20\x20\x20\x20data:\x20{\x20labels:\x20[],\x20datasets:\x20[{\x20label:\x20\x27Daily\x20Traffic\x20(MB)\x27,\x20data:\x20[],\x20backgroundColor:\x20\x27#3b82f6\x27\x20}]\x20},\x0a\x20\x20\x20\x20\x20\x20options:\x20{\x20responsive:\x20true,\x20scales:\x20{\x20y:\x20{\x20beginAtZero:\x20true\x20}\x20}\x20}\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20async\x20function\x20loadUserData(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20userData\x20=\x20await\x20fetch(\x27/api/user/\x27\x20+\x20uuid).then(res\x20=>\x20res.json());\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27traffic-used\x27).textContent\x20=\x20(userData.traffic_used\x20/\x20(1024\x20*\x201024\x20*\x201024)).toFixed(2)\x20+\x20\x27\x20GB\x27;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiration\x27).textContent\x20=\x20userData.expiration_date\x20+\x20\x27\x20\x27\x20+\x20userData.expiration_time;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27status\x27).textContent\x20=\x20userData.is_expired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27;\x0a\x20\x20\x20\x20\x20\x20generateQR(\x27vless://\x27\x20+\x20userData.uuid\x20+\x20\x27@example.com:443?type=ws#UserConfig\x27);\x0a\x20\x20\x20\x20\x20\x20loadHistory(uuid);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20generateQR(text)\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27qr-code\x27).innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20new\x20QRCode(document.getElementById(\x27qr-code\x27),\x20text);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20async\x20function\x20loadHistory(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20history\x20=\x20await\x20fetch(\x27/api/user/\x27\x20+\x20uuid\x20+\x20\x27/history\x27).then(res\x20=>\x20res.json());\x0a\x20\x20\x20\x20\x20\x20historyChart.data.labels\x20=\x20history.map(h\x20=>\x20h.date);\x0a\x20\x20\x20\x20\x20\x20historyChart.data.datasets[0].data\x20=\x20history.map(h\x20=>\x20h.download\x20/\x20(1024\x20*\x201024));\x0a\x20\x20\x20\x20\x20\x20historyChart.update();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20testConfig()\x20{\x0a\x20\x20\x20\x20\x20\x20alert(\x27Config\x20test:\x20Valid\x27);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20downloadQR()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20canvas\x20=\x20document.querySelector(\x27#qr-code\x20canvas\x27);\x0a\x20\x20\x20\x20\x20\x20canvas.toBlob(blob\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20url\x20=\x20URL.createObjectURL(blob);\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20a\x20=\x20document.createElement(\x27a\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.href\x20=\x20url;\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.download\x20=\x20\x27qr.png\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20a.click();\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20const\x20uuid\x20=\x20location.pathname.slice(1);\x0a\x20\x20\x20\x20loadUserData(uuid);\x0a\x20\x20</script>\x0a</body>\x0a</html>',custom404HTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<title>404\x20-\x20Not\x20Found</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20body\x20{\x20background:\x20#0f172a;\x20color:\x20#f9fafb;\x20text-align:\x20center;\x20padding:\x20100px;\x20font-family:\x20sans-serif;\x20}\x0a\x20\x20\x20\x20h1\x20{\x20font-size:\x2048px;\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<h1>404\x20-\x20Page\x20Not\x20Found</h1>\x0a\x20\x20<p>The\x20requested\x20resource\x20could\x20not\x20be\x20found.</p>\x0a</body>\x0a</html>',robotsTxt='User-agent:\x20*\x0aDisallow:\x20/admin/\x0aDisallow:\x20/api/\x0aSitemap:\x20https://yourdomain.com/sitemap.xml',securityTxt='Contact:\x20mailto:security@yourdomain.com\x0aExpires:\x202026-12-31T23:59:59.000Z\x0aPreferred-Languages:\x20en\x0aPolicy:\x20https://yourdomain.com/security-policy';async function ProtocolOverWSHandler(a,b,c,d){const e=a['headers']['get']('Upgrade');if(!e||e!=='websocket')return new Response('Expected\x20Upgrade:\x20websocket',{'status':0x1aa});const f=new WebSocketPair(),[g,h]=Object['values'](f);h['accept']();const i=new URL(a['url']),j=i['hostname']['lastIndexOf']('---'),k=i['hostname']['slice'](j+0x3);let l='',m='';const n=a['headers']['get']('sec-websocket-protocol')||'';if(i['pathname']['includes']('/tcp/')){const s=connect({'hostname':b['proxyIP']||'127.0.0.1','port':b['proxyPort']||0x1bb});return h['addEventListener']('message',t=>{s['write'](t['data']);}),s['readable']['pipeTo'](h['writable']['getWriter']())['catch'](()=>{}),new Response(null,{'status':0x65,'webSocket':g});}const o=(t,u)=>{console['log']('['+k+']\x20'+t,u||'');},p=t=>{const u=t['byteLength'],v=new Uint8Array(u),w=new DataView(t);for(let x=0x0;x<u;x++){v[x]=w['getUint8'](x);}return v;},q=t=>{return stringify(p(t['buffer']));},r=t=>{return isValidUUID(t);};if(i['pathname']['includes']('/vless')){let t='';const u=i['pathname']['match'](/\/vless\/(.*?)\/(.*)/);if(u)t=u[0x1];else return new Response('Invalid\x20path',{'status':0x190});const v=t;if(!r(v))return o('Invalid\x20UUID'),new Response('Invalid\x20UUID',{'status':0x190});l=i['hostname'],m=i['port']||'443',o('Connecting\x20to\x20'+l+':'+m);let w;try{w=connect({'hostname':b['proxyIP'],'port':parseInt(b['proxyPort'])});}catch(z){return o('Socket\x20connect\x20error',z),new Response('Socket\x20connection\x20failed',{'status':0x1f4});}h['addEventListener']('message',async A=>{const B=A['data'];try{w['write'](B);}catch(C){w['close']();}}),w['readable']['pipeTo'](h['writable']['getWriter']())['catch'](()=>{});let x=![];w['writable']['getWriter']()['write'](Uint8Array['from']([0x5,0x0,0x0]));const y=w['writable']['getWriter']();return await y['write'](Uint8Array['from']([0x5,0x1,0x0,0x3,l['length'],...new TextEncoder()['encode'](l),m>>0x8,m&0xff])),y['releaseLock'](),w['readable']['pipeTo'](h['writable']['getWriter']())['catch'](()=>{}),new Response(null,{'status':0x65,'webSocket':g});}return new Response('Not\x20found',{'status':0x194});}export default{async 'fetch'(a,b,c){try{await ensureTablesExist(b,c);const d=new URL(a['url']),f=a['headers']['get']('CF-Connecting-IP')||'unknown',g=await Config['fromEnv'](b);if(d['pathname']==='/robots.txt'){const k=new Headers({'Content-Type':'text/plain'});return addSecurityHeaders(k,null),new Response(robotsTxt,{'headers':k});}if(d['pathname']==='/.well-known/security.txt'){const l=new Headers({'Content-Type':'text/plain'});return addSecurityHeaders(l,null),new Response(securityTxt,{'headers':l});}if(d['pathname']==='/admin'){const m=generateNonce(),n=adminLoginHTML['replace']('CSP_NONCE_PLACEHOLDER',m)['replace']('ADMIN_PATH_PLACEHOLDER','/admin/login'),o=new Headers({'Content-Type':'text/html'});return addSecurityHeaders(o,m),new Response(n,{'headers':o});}if(d['pathname']==='/admin/dashboard'){const p=generateNonce(),q=adminPanelHTML['replace']('CSP_NONCE_PLACEHOLDER',p),r=new Headers({'Content-Type':'text/html'});return addSecurityHeaders(r,p,{'img':'https://cdn.jsdelivr.net','connect':'wss://your-ws-endpoint'}),new Response(q,{'headers':r});}const h=d['pathname']['slice'](0x1);if(isValidUUID(h)){const s=await getUserData(b,h,c);if(!s)return new Response('User\x20not\x20found',{'status':0x193});const t=generateNonce(),u=userPanelHTML['replace']('CSP_NONCE_PLACEHOLDER',t),v=new Headers({'Content-Type':'text/html'});return addSecurityHeaders(v,t),new Response(u,{'headers':v});}if(a['headers']['get']('Upgrade')==='websocket')return ProtocolOverWSHandler(a,g,b,c);if(d['pathname']['startsWith']('/xray/')||d['pathname']['startsWith']('/sb/')){const w=d['pathname']['startsWith']('/xray/')?'xray':'sb',x=d['pathname']['split']('/')[0x2];return handleIpSubscription(w,x,d['hostname']);}if(b['ROOT_PROXY_URL']&&d['pathname']==='/'){const y=new URL(b['ROOT_PROXY_URL']+d['pathname']+d['search']);y['hostname']=new URL(b['ROOT_PROXY_URL'])['hostname'];const z=new Request(y,a);return fetch(z);}const i='<!DOCTYPE\x20html><html><head><title>Welcome\x20to\x20nginx!</title></head><body><h1>Welcome\x20to\x20nginx!</h1></body></html>',j=new Headers({'Content-Type':'text/html'});return addSecurityHeaders(j,null),new Response(i,{'headers':j});}catch(A){return console['error']('Fetch\x20error:',A),new Response(custom404HTML,{'status':0x194,'headers':{'Content-Type':'text/html'}});}},async 'scheduled'(a,b,c){await performHealthCheck(b,c),await cleanupOldIps(b,c);}};